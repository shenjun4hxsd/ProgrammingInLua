##è½½å…¥Luaè„šæœ¬

####ä¸€ã€é€šè¿‡æ–‡ä»¶

```csharp
    using UnityEngine;
    using System.Collections;
    using XLua;
    
    public class ByFile : MonoBehaviour {
        LuaEnv luaenv = null;
        void Start()
        {
            luaenv = new LuaEnv();
            // ä½¿ç”¨é»˜è®¤loaderåŠ è½½Resourcesä¸‹çš„"byfile.lua.txt"æ–‡ä»¶
            luaenv.DoString("require 'byfile'");
        }
    
        void Update()
        {
            if (luaenv != null)
            {
                luaenv.Tick();
            }
        }
    
        void OnDestroy()
        {
            luaenv.Dispose();
        }
    }
```

å°†`byfile.lua.txt`å­˜æ”¾åœ¨`Resources`æ–‡ä»¶å¤¹ä¸‹ã€‚
æ³¨æ„ï¼šæ”¾åœ¨Resourcesæ–‡ä»¶å¤¹ä¸‹çš„luaæ–‡ä»¶å¿…é¡»ä»¥â€œ`.lua.txt`â€åŽç¼€ã€‚

```lua
    print('hello world')
```

####äºŒã€é€šè¿‡å­—ç¬¦ä¸²

```csharp
    /*
     *  created by shenjun
     */
    
    using System.Collections;
    using System.Collections.Generic;
    using UnityEngine;
    
    /*
     * 1ã€å¼•å…¥å‘½åç©ºé—´
     */
    using XLua;
    
    namespace shenjun
    {
    	public class ByString : MonoBehaviour {
    
            LuaEnv luaEnv = new LuaEnv();
    
            [Multiline(10)]
            public string luaStr1 = 
                @"function Show(...)
                     local t = {...}
                     for i=1,#t do
                         print(t[i])
                     end
                  end
                  Show(5,3,4,1,2)";
    
            [Multiline(10)]
            public string luaStr2 = 
                @"function GetResult()
                      return 1, '2'
                  end
                  return GetResult()";
    
    		void Start () {
                
                // public object[] DoString(string chunk, string chunkName = "chunk", LuaTable env = null)
                // å‚æ•°1: Luaä»£ç 
                // å‚æ•°2: å‘ç”Ÿerroræ—¶debugæ˜¾ç¤ºä¿¡æ¯æ—¶ä½¿ç”¨ï¼ŒæŒ‡æ˜ŽæŸæŸä»£ç å—çš„æŸè¡Œé”™è¯¯
                // å‚æ•°3: ä¸ºè¿™ä¸ªä»£ç å—
                // è¿”å›žå€¼ï¼šLuaä»£ç çš„è¿”å›žå€¼
    
                // æ‰§è¡ŒLuaä»£ç 
                luaEnv.DoString("print('Hello World!')");
                luaEnv.DoString(luaStr1);
                object[] results = luaEnv.DoString(luaStr2);
                if(results != null)
                {
                    foreach (var item in results)
                    {
                        Debug.Log(item);
                    }
                }
            }
    		
    		void Update () {
    
                if(luaEnv != null)
                {
                    // æ¸…é™¤Luaæœªæ‰‹åŠ¨è°ƒç”¨çš„LuaBaseï¼ˆæ¯”å¦‚LuaTableï¼ŒLuaFunctionï¼‰ï¼ŒåŠå…¶ä»–ä¸€äº›äº‹æƒ…ã€‚
                    // éœ€è¦å®šæœŸè°ƒç”¨ã€‚
                    luaEnv.Tick();
                }
    			
    		}
    
            private void OnDestroy()
            {
                luaEnv.Dispose();
            }
        }
    }
```

####ä¸‰ã€é€šè¿‡åŠ è½½å™¨

**Example01 :**

```csharp
    using UnityEngine;
    using System.Collections;
    using XLua;
    
    public class CustomLoader : MonoBehaviour {
        LuaEnv luaenv = null;
        void Start()
        {
            luaenv = new LuaEnv();
            luaenv.AddLoader((ref string filename) => {
                 if (filename == "InMemory")
                 {
                     string script = "return {ccc = 9999}";
                     return System.Text.Encoding.UTF8.GetBytes(script);
                 }
                 return null;
             });
            luaenv.DoString("print('InMemory.ccc=', require('InMemory').ccc)");
        }
    
        void Update()
        {
            if (luaenv != null)
            {
                luaenv.Tick();
            }
        }
    
        void OnDestroy()
        {
            luaenv.Dispose();
        }
    }
```

**Example02 :**

```csharp
    /*
     *  created by shenjun
     */
    
    using System.Collections;
    using System.Collections.Generic;
    using UnityEngine;
    using System.IO;
    
    using XLua;
    
    namespace shenjun
    {
    	public class ByLoader : MonoBehaviour {
    
            LuaEnv luaEnv = new LuaEnv();
    
    		void Start () {
    
                // æ³¨å†Œè‡ªå®šä¹‰loader é€šè¿‡è‡ªå®šä¹‰loaderåŠ è½½çš„æ–‡ä»¶ï¼Œæ–‡ä»¶åŽç¼€å¯ä»¥ä½¿ç”¨.lua
                luaEnv.AddLoader((ref string filePath)=>{
                    string path = Application.dataPath + "/LessonXLua_shenjun/01_LoadLuaScript/03_ByLoader/" + filePath + ".lua.txt";
                    if(File.Exists(path))
                    {
                        string text = "";
                        using (StreamReader sr = new StreamReader(path))
                        {
                            try
                            {
                                text = sr.ReadToEnd();
                            }
                            catch(System.Exception ex)
                            {
                                Debug.LogError("ReadFile Error :" + path + "; ErrorMsg :" + ex.Message);
                                return null;
                            }
                        }
                        return System.Text.Encoding.UTF8.GetBytes(text);
    
                        //byte[] buffer;
                        //using(FileStream fsReader = new FileStream(path, FileMode.Open, FileAccess.Read))
                        //{
                        //    buffer = new byte[fsReader.Length];
                        //    try
                        //    {
                        //        fsReader.Read(buffer, 0, (int)fsReader.Length);
                        //        return buffer;
                        //    }
                        //    catch
                        //    {
                        //        return null;
                        //    }
                        //}
                    }
                    else
                    {
                        return null;
                    }
                });
    
                // å¦‚æžœæ³¨å†Œäº†è‡ªå®šä¹‰çš„loaderï¼Œä¼šå…ˆæŸ¥æ‰¾è‡ªå®šä¹‰loaderï¼Œå¦‚æžœè‡ªå®šä¹‰loaderè¿”å›žnullï¼Œåˆ™ä¼šä½¿ç”¨é»˜è®¤loaderï¼Œå¦‚æžœé»˜è®¤loaderä¹Ÿæ²¡æ‰¾åˆ°ï¼Œåˆ™æŠ¥é”™ã€‚
                luaEnv.DoString("require 'byloader'");
    		}
    		
    		void Update () {
    
                if(luaEnv != null)
                {
                    luaEnv.Tick();
                }
    			
    		}
    
            private void OnDestroy()
            {
                luaEnv.Dispose();
            }
        }
    }
```

**byloader.lua.txt**

```lua
    print('byCustomLoader: hello world')
```

ðŸ”š